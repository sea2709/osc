!function(t,e,i){i.StripeCheckoutModal=i.Modal_Box.extend({el:"#stripe_checkout_modal",events:{"submit #payment-form":"submitPayment"},initialize:function(t){i.Modal_Box.prototype.initialize.apply(this,arguments),this.options=_.extend(this,t),void 0!==this.options.checkoutData&&(this.checkoutData=this.options.checkoutData,this.productData=this.checkoutData.get("p_data")),this.blockUi=new i.BlockUi,this.stripe=Stripe(mje_stripe.publishable_key);var e=this.stripe.elements(),o={base:{color:"#303238",fontSize:"16px",fontSmoothing:"antialiased","::placeholder":{color:"#ccc"}},invalid:{color:"#e5424d",":focus":{color:"#303238"}}};this.card=e.create("card",{style:o}),this.card.mount("#card-element");var a=this;this.card.addEventListener("change",function(t){var e=a.$el.find("#card-errors");t.error?e.text(t.error.message):e.text("")})},submitPayment:function(e){e.preventDefault(),$form=t(e.currentTarget);var i=this;i.blockUi.block($form.find(".submit-payment")),this.createToken().catch(function(e){e?i.processPayment(t("#stripeToken").val()):i.blockUi.unblock()})},createToken:function(){var t=this;return this.stripe.createToken(this.card).then(function(e){throw e.error?(t.$el.find("#card-errors").text(e.error.message),!1):(t.stripeTokenHandler(e.token),!0)})},stripeTokenHandler:function(t){this.$el.find("#payment-form").append('<input type="hidden" name="stripeToken" id="stripeToken" value="'+t.id+'"/>')},processPayment:function(t){var e=this;e.checkoutData.set("p_payment","stripe"),e.productData.payment_type="stripe",e.checkoutData.set("token",t),e.checkoutData.save("","",{beforeSend:function(){},success:function(t,i,o){console.log(i),i.success?(AE.pubsub.trigger("ae:notification",{notice_type:"success",msg:i.data.msg}),setTimeout(function(){window.location.href=i.data.url,e.blockUi.unblock()},2e3)):(AE.pubsub.trigger("ae:notification",{notice_type:"error",msg:i.msg}),e.blockUi.unblock())}})}}),i.ListPayment=Backbone.View.extend({el:".list-payment-gateway",events:{"click #stripe-gateway":"openStripeModal"},initialize:function(){AE.pubsub.on("mje:after:setup:checkout",this.afterSetupCheckout,this)},openStripeModal:function(){var t=this;"1"===mje_stripe.is_has_api_key&&(void 0===this.stripeModal&&(this.stripeModal=new i.StripeCheckoutModal({checkoutData:t.checkoutData})),this.stripeModal.openModal())},afterSetupCheckout:function(t){this.checkoutData=t}}),t(document).ready(function(){new i.ListPayment;var e="#exp_year, #exp_month, #cvc";t(e).bind("click focus",function(e){e.stopPropagation(),t(this).parent(".form-label").addClass("active")}),t(e).bind("focusout",function(e){e.stopPropagation(),t(this).parent(".form-label").removeClass("active")}),t(window).on("click",function(){t(".card-expiration").removeClass("active")})})}(jQuery,AE.Models,AE.Views);